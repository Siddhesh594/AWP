<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chatbot</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="chat-container">
    <h2>Chatbot</h2>
    <div id="chat-box"></div>
    <input type="text" id="user-input" placeholder="Type your message">
    <button id="send-btn">Send</button>
</div>

<script>
const chatBox = document.getElementById("chat-box");
const userInput = document.getElementById("user-input");
const sendBtn = document.getElementById("send-btn");

async function sendMessage() {
    const message = userInput.value.trim();
    if (!message) return;

    chatBox.innerHTML += `<div class="user-msg">${message}</div>`;
    userInput.value = "";

    try {
        const response = await fetch("/api/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ userMessage: message })
        });
        const data = await response.json();
        chatBox.innerHTML += `<div class="bot-msg">${data.botReply}</div>`;
        chatBox.scrollTop = chatBox.scrollHeight;
    } catch (err) {
        console.error("Error:", err);
        chatBox.innerHTML += `<div class="bot-msg">Error: could not get response</div>`;
    }
}

sendBtn.addEventListener("click", sendMessage);
userInput.addEventListener("keypress", e => {
    if (e.key === "Enter") sendMessage();
});

// Load previous messages
async function loadMessages() {
    try {
        const res = await fetch("/api/chat");
        const messages = await res.json();
        messages.forEach(msg => {
            chatBox.innerHTML += `<div class="user-msg">${msg.userMessage}</div>`;
            chatBox.innerHTML += `<div class="bot-msg">${msg.botReply}</div>`;
        });
    } catch (err) {
        console.error(err);
    }
}

loadMessages();
</script>
</body>
</html>
